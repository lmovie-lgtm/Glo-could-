{'role': 'assistant', 'content': 'Now let me create the customer-side JavaScript with full transfer functionality:\n\n<function_calls>\n<create-file file_path="js/customer.js">\n// Global Pilgrim Bank - Customer Dashboard JavaScript\n// Full money transfer functionality\n\nlet currentCustomer = null;\nlet autoTradingInterval = null;\nlet miningInterval = null;\n\n// ============================================\n// CUSTOMER DASHBOARD FUNCTIONS\n// ============================================\n\nfunction loadCustomerDashboard() {\n    const customerData = localStorage.getItem(\'currentCustomer\');\n    \n    if (!customerData) {\n        alert(\'Session expired. Please login again.\');\n        window.location.href = \'customer-login.html\';\n        return;\n    }\n    \n    currentCustomer = JSON.parse(customerData);\n    \n    // Refresh customer data from storage\n    const customers = JSON.parse(localStorage.getItem(\'customers\')) || [];\n    const freshCustomer = customers.find(c => c.account === currentCustomer.account);\n    \n    if (freshCustomer) {\n        currentCustomer = freshCustomer;\n        localStorage.setItem(\'currentCustomer\', JSON.stringify(currentCustomer));\n    }\n    \n    // Update UI\n    document.getElementById(\'customerName\').textContent = \'Welcome, \' + currentCustomer.name;\n    document.getElementById(\'accountNumber\').textContent = currentCustomer.account;\n    document.getElementById(\'serialNumber\').textContent = currentCustomer.serial;\n    \n    // Update balances\n    updateBalances();\n    \n    // Load transaction history\n    loadCustomerTransactions();\n    \n    // Load virtual cards\n    loadVirtualCards();\n    \n    // Check if wallet exists\n    if (currentCustomer.pilgrimWallet) {\n        document.getElementById(\'pilgrimWallet\').textContent = currentCustomer.pilgrimWallet;\n    }\n    \n    // Log to terminal\n    logCustomerActivity(\'DASHBOARD_LOADED\', \'Customer dashboard loaded\');\n}\n\nfunction updateBalances() {\n    document.getElementById(\'balanceNGN\').textContent = \'₦\' + (currentCustomer.balance || 0).toLocaleString(\'en-NG\', {minimumFractionDigits: 2});\n    document.getElementById(\'balanceUSD\').textContent = \'$\' + (currentCustomer.balanceUSD || 0).toLocaleString(\'en-US\', {minimumFractionDigits: 2});\n    document.getElementById(\'balanceEUR\').textContent = \'€\' + (currentCustomer.balanceEUR || 0).toLocaleString(\'de-DE\', {minimumFractionDigits: 2});\n    document.getElementById(\'balanceGBP\').textContent = \'£\' + (currentCustomer.balanceGBP || 0).toLocaleString(\'en-GB\', {minimumFractionDigits: 2});\n    \n    // Update profit balance if element exists\n    const profitDisplay = document.getElementById(\'profitBalanceDisplay\');\n    if (profitDisplay) {\n        profitDisplay.textContent = \'$\' + (currentCustomer.profitBalance || 0).toLocaleString(\'en-US\', {minimumFractionDigits: 2});\n    }\n}\n\n// ============================================\n// MONEY TRANSFER FUNCTIONS - FULL FUNCTIONALITY\n// ============================================\n\nfunction sendMoney() {\n    const transferType = document.getElementById(\'transferType\').value;\n    const amount = parseFloat(document.getElementById(\'sendAmount\').value);\n    const currency = document.getElementById(\'sendCurrency\').value;\n    const description = document.getElementById(\'sendDescription\').value.trim() || \'Transfer\';\n    const recipientPin = document.getElementById(\'recipientPin\') ? document.getElementById(\'recipientPin\').value : null;\n    \n    if (!amount || amount <= 0) {\n        showToast(\'Please enter a valid amount\', \'error\');\n        return;\n    }\n    \n    // Check balance\n    const currentBalance = currency === \'NGN\' ? currentCustomer.balance :\n                         currency === \'USD\' ? currentCustomer.balanceUSD :\n                         currency === \'EUR\' ? currentCustomer.balanceEUR : currentCustomer.balanceGBP;\n    \n    if (currentBalance < amount) {\n        showToast(\'Insufficient funds. Current balance: \' + currentBalance.toLocaleString() + \' \' + currency, \'error\');\n        return;\n    }\n    \n    let recipientInfo = \'\';\n    let recipientAccount = \'\';\n    let recipientName = \'\';\n    let bankCode = \'\';\n    \n    if (transferType === \'local\') {\n        const bank = document.getElementById(\'recipientBank\').value;\n        const account = document.getElementById(\'recipientAccount\').value.trim();\n        const name = document.getElementById(\'recipientName\').value.trim();\n        \n        if (!account || !name) {\n            showToast(\'Please enter recipient account and name\', \'error\');\n            return;\n        }\n        \n        recipientAccount = account;\n        recipientName = name;\n        bankCode = bank;\n        recipientInfo = `${bank} - ${account} (${name})`;\n        \n        // Check if it\'s a Global Pilgrim Bank transfer\n        if (bank === \'GPB\') {\n            processInternalTransfer(account, amount, currency, description, name);\n            return;\n        }\n    } else {\n        const bank = document.getElementById(\'internationalBank\').value.trim();\n        const account = document.getElementById(\'recipientAccount\').value.trim();\n        const name = document.getElementById(\'recipientName\').value.trim();\n        const swift = document.getElementById(\'swiftCode\').value.trim();\n        const country = document.getElementById(\'recipientCountry\').value;\n        \n        if (!account || !name || !swift) {\n            showToast(\'Please fill in all international transfer details\', \'error\');\n            return;\n        }\n        \n        recipientAccount = account;\n        recipientName = name;\n        bankCode = swift;\n        recipientInfo = `${bank} (${country}) - ${account} - SWIFT: ${swift}`;\n    }\n    \n    // Process external transfer\n    processExternalTransfer(transferType, bankCode, recipientAccount, recipientName, amount, currency, description, recipientInfo);\n}\n\nfunction processInternalTransfer(accountNumber, amount, currency, description, recipientName) {\n    const customers = JSON.parse(localStorage.getItem(\'customers\')) || [];\n    const customerIndex = customers.findIndex(c => c.account === currentCustomer.account);\n    const recipientIndex = customers.findIndex(c => c.account === accountNumber || c.tenDigitAccount === accountNumber);\n    \n    if (recipientIndex === -1) {\n        showToast(\'Recipient account not found in Global Pilgrim Bank\', \'error\');\n        return;\n    }\n    \n    // Debit sender\n    if (currency === \'NGN\') customers[customerIndex].balance -= amount;\n    else if (currency === \'USD\') customers[customerIndex].balanceUSD -= amount;\n    else if (currency === \'EUR\') customers[customerIndex].balanceEUR -= amount;\n    else customers[customerIndex].balanceGBP -= amount;\n    \n    // Credit recipient\n    if (currency === \'NGN\') customers[recipientIndex].balance += amount;\n    else if (currency === \'USD\') customers[recipientIndex].balanceUSD += amount;\n    else if (currency === \'EUR\') customers[recipientIndex].balanceEUR += amount;\n    else customers[recipientIndex].balanceGBP += amount;\n    \n    // Add ledger entries\n    const transferId = \'TXN\' + Date.now();\n    \n    customers[customerIndex].ledger.push({\n        date: new Date().toISOString(),\n        type: \'debit\',\n        amount: amount,\n        currency: currency,\n        description: `Internal Transfer to ${recipientName} (${accountNumber}): ${description}`\n    });\n    \n    customers[recipientIndex].ledger.push({\n        date: new Date().toISOString(),\n        type: \'credit\',\n        amount: amount,\n        currency: currency,\n        description: `Internal Transfer from ${currentCustomer.name}: ${description}`\n    });\n    \n    localStorage.setItem(\'customers\', JSON.stringify(customers));\n    \n    // Update session\n    currentCustomer = customers[customerIndex];\n    localStorage.setItem(\'currentCustomer\', JSON.stringify(currentCustomer));\n    \n    // Update UI\n    updateBalances();\n    loadCustomerTransactions();\n    \n    logCustomerActivity(\'INTERNAL_TRANSFER\', `Transferred ${amount} ${currency} to ${recipientName}`);\n    showToast(`Transfer successful! ${amount.toLocaleString()} ${currency} sent to ${recipientName}`, \'success\');\n    \n    // Clear form\n    clearTransferForm();\n}\n\nfunction processExternalTransfer(transferType, bankCode, recipientAccount, recipientName, amount, currency, description, recipientInfo) {\n    const customers = JSON.parse(localStorage.getItem(\'customers\')) || [];\n    const customerIndex = customers.findIndex(c => c.account === currentCustomer.account);\n    \n    // Calculate fee\n    const fee = amount * (transferType === \'local\' ? 0.01 : 0.02);\n    const totalAmount = amount + fee;\n    \n    // Check if customer has enough for amount + fee\n    const currentBalance = currency === \'NGN\' ? currentCustomer.balance :\n                         currency === \'USD\' ? currentCustomer.balanceUSD :\n                         currency === \'EUR\' ? currentCustomer.balanceEUR : currentCustomer.balanceGBP;\n    \n    if (currentBalance < totalAmount) {\n        showToast(\'Insufficient funds. Amount + Fee: \' + totalAmount.toLocaleString() + \' \' + currency, \'error\');\n        return;\n    }\n    \n    // Debit customer (amount + fee)\n    if (currency === \'NGN\') customers[customerIndex].balance -= totalAmount;\n    else if (currency === \'USD\') customers[customerIndex].balanceUSD -= totalAmount;\n    else if (currency === \'EUR\') customers[customerIndex].balanceEUR -= totalAmount;\n    else customers[customerIndex].balanceGBP -= totalAmount;\n    \n    // Create transfer record\n    const transferId = generateTransferId();\n    \n    const transferData = {\n        id: transferId,\n        sourceBank: \'Global Pilgrim Bank\',\n        sourceAccount: currentCustomer.account,\n        destinationBank: bankCode,\n        destinationAccount: recipientAccount,\n        recipientName: recipientName,\n        amount: amount,\n        currency: currency,\n        fee: fee,\n        description: description,\n        type: transferType === \'local\' ? \'LOCAL_TRANSFER\' : \'SWIFT_TRANSFER\',\n        status: \'pending\',\n        createdAt: new Date().toISOString(),\n        signal: generateTransferSignal()\n    };\n    \n    // Add ledger entry\n    customers[customerIndex].ledger.push({\n        date: new Date().toISOString(),\n        type: \'debit\',\n        amount: amount,\n        currency: currency,\n        description: `${transferType === \'local\' ? \'Local\' : \'International\'} Transfer to ${recipientInfo}: ${description}`\n    });\n    \n    customers[customerIndex].ledger.push({\n        date: new Date().toISOString(),\n        type: \'debit\',\n        amount: fee,\n        currency: currency,\n        description: `${transferType === \'local\' ? \'Local\' : \'International\'} Transfer Fee`\n    });\n    \n    // Add to pending transfers\n    const pendingTransfers = JSON.parse(localStorage.getItem(\'pendingTransfers\')) || [];\n    pendingTransfers.push(transferData);\n    localStorage.setItem(\'pendingTransfers\', JSON.stringify(pendingTransfers));\n    \n    localStorage.setItem(\'customers\', JSON.stringify(customers));\n    \n    // Update session\n    currentCustomer = customers[customerIndex];\n    localStorage.setItem(\'currentCustomer\', JSON.stringify(currentCustomer));\n    \n    // Log signal transfer\n    logSignalTransfer(transferData, \'initiated\');\n    logCustomerActivity(\'EXTERNAL_TRANSFER\', `Initiated transfer of ${amount} ${currency} to ${recipientInfo}`);\n    \n    // Simulate external bank processing\n    simulateExternalBankProcessing(transferData);\n    \n    // Update UI\n    updateBalances();\n    loadCustomerTransactions();\n    \n    showToast(`Transfer initiated! ${amount.toLocaleString()} ${currency} being sent to ${recipientInfo}. Fee: ${fee.toLocaleString()} ${currency}`, \'success\');\n    \n    // Clear form\n    clearTransferForm();\n}\n\nfunction simulateExternalBankProcessing(transferData) {\n    // Simulate the signal being sent to external bank\n    setTimeout(() => {\n        // Send acknowledgment signal\n        logSignalTransfer(transferData, \'acknowledged\');\n        \n        // Simulate processing at external bank\n        setTimeout(() => {\n            transferData.status = \'processing\';\n            logSignalTransfer(transferData, \'processing\');\n            \n            // Final confirmation\n            setTimeout(() => {\n                transferData.status = \'completed\';\n                transferData.completedAt = new Date().toISOString();\n                logSignalTransfer(transferData, \'completed\');\n                \n                // Update pending transfers\n                const pendingTransfers = JSON.parse(localStorage.getItem(\'pendingTransfers\')) || [];\n                const index = pendingTransfers.findIndex(t => t.id === transferData.id);\n                if (index !== -1) {\n                    pendingTransfers[index] = transferData;\n                    localStorage.setItem(\'pendingTransfers\', JSON.stringify(pendingTransfers));\n                }\n                \n                logCustomerActivity(\'TRANSFER_COMPLETED\', `Transfer completed: ${transferData.amount} ${transferData.currency} to ${transferData.destinationBank}`);\n            }, 3000);\n        }, 2000);\n    }, 1000);\n}\n\nfunction generateTransferSignal() {\n    const timestamp = Date.now().toString(36);\n    const random = generateRandomString(16);\n    return `SIG-${timestamp}-${random}`;\n}\n\nfunction clearTransferForm() {\n    document.getElementById(\'recipientAccount\').value = \'\';\n    document.getElementById(\'recipientName\').value = \'\';\n    document.getElementById(\'sendAmount\').value = \'\';\n    document.getElementById(\'sendDescription\').value = \'\';\n    if (document.getElementById(\'recipientPin\')) {\n        document.getElementById(\'recipientPin\').value = \'\';\n    }\n}\n\n// ============================================\n// RECEIVE MONEY FUNCTIONS\n// ============================================\n\nfunction receiveMoney() {\n    const senderBank = document.getElementById(\'senderBank\').value.trim();\n    const senderAccount = document.getElementById(\'senderAccount\').value.trim();\n    const senderName = document.getElementById(\'senderName\').value.trim();\n    const amount = parseFloat(document.getElementById(\'receiveAmount\').value);\n    const currency = document.getElementById(\'receiveCurrency\').value;\n    const reference = document.getElementById(\'referenceNumber\').value.trim();\n    const description = document.getElementById(\'receiveDescription\').value.trim();\n    \n    if (!amount || amount <= 0) {\n        showToast(\'Please enter a valid amount\', \'error\');\n        return;\n    }\n    \n    if (!senderBank || !senderAccount || !senderName) {\n        showToast(\'Please fill in sender details\', \'error\');\n        return;\n    }\n    \n    const customers = JSON.parse(localStorage.getItem(\'customers\')) || [];\n    const customerIndex = customers.findIndex(c => c.account === currentCustomer.account);\n    \n    // Credit customer\n    if (currency === \'NGN\') customers[customerIndex].balance += amount;\n    else if (currency === \'USD\') customers[customerIndex].balanceUSD += amount;\n    else if (currency === \'EUR\') customers[customerIndex].balanceEUR += amount;\n    else customers[customerIndex].balanceGBP += amount;\n    \n    // Create incoming transfer record\n    const transferId = generateTransferId();\n    \n    const transferData = {\n        id: transferId,\n        sourceBank: senderBank,\n        sourceAccount: senderAccount,\n        senderName: senderName,\n        destinationBank: \'Global Pilgrim Bank\',\n        destinationAccount: currentCustomer.account,\n        recipientName: currentCustomer.name,\n        amount: amount,\n        currency: currency,\n        reference: reference,\n        description: description || \'Incoming transfer\',\n        type: \'INCOMING_TRANSFER\',\n        status: \'received\',\n        receivedAt: new Date().toISOString(),\n        signal: generateTransferSignal()\n    };\n    \n    // Add ledger entry\n    customers[customerIndex].ledger.push({\n        date: new Date().toISOString(),\n        type: \'credit\',\n        amount: amount,\n        currency: currency,\n        description: `Incoming Transfer from ${senderName} (${senderBank}): ${description}`\n    });\n    \n    // Log to pending transfers for tracking\n    const pendingTransfers = JSON.parse(localStorage.getItem(\'pendingTransfers\')) || [];\n    pendingTransfers.push(transferData);\n    localStorage.setItem(\'pendingTransfers\', JSON.stringify(pendingTransfers));\n    \n    // Log signal\n    logSignalTransfer(transferData, \'received\');\n    logCustomerActivity(\'MONEY_RECEIVED\', `Received ${amount} ${currency} from ${senderName} (${senderBank})`);\n    \n    localStorage.setItem(\'customers\', JSON.stringify(customers));\n    \n    // Update session\n    currentCustomer = customers[customerIndex];\n    localStorage.setItem(\'currentCustomer\', JSON.stringify(currentCustomer));\n    \n    // Update UI\n    updateBalances();\n    loadCustomerTransactions();\n    \n    showToast(`Successfully received ${amount.toLocaleString()} ${currency} from ${senderName}!`, \'success\');\n    \n    // Clear form\n    document.getElementById(\'senderBank\').value = \'\';\n    document.getElementById(\'senderAccount\').value = \'\';\n    document.getElementById(\'senderName\').value = \'\';\n    document.getElementById(\'receiveAmount\').value = \'\';\n    document.getElementById(\'referenceNumber\').value = \'\';\n    document.getElementById(\'receiveDescription\').value = \'\';\n}\n\n// ============================================\n// WITHDRAWAL FUNCTIONS\n// ============================================\n\nfunction withdrawFunds() {\n    const withdrawType = document.getElementById(\'withdrawType\').value;\n    const amount = parseFloat(document.getElementById(\'withdrawAmount\').value);\n    const currency = document.getElementById(\'withdrawCurrency\').value;\n    const beneficiaryName = document.getElementById(\'beneficiaryName\').value.trim();\n    const beneficiaryAccount = document.getElementById(\'beneficiaryAccount\').value.trim();\n    const beneficiaryBank = document.getElementById(\'beneficiaryBank\').value.trim();\n    const swiftCode = document.getElementById(\'withdrawSwiftCode\').value.trim();\n    \n    if (!amount || amount <= 0) {\n        showToast(\'Please enter a valid amount\', \'error\');\n        return;\n    }\n    \n    if (!beneficiaryName || !beneficiaryAccount) {\n        showToast(\'Please fill in beneficiary details\', \'error\');\n        return;\n    }\n    \n    // Determine which balance to withdraw from\n    let balanceSource = \'\';\n    if (withdrawType === \'main\') {\n        balanceSource = currency === \'NGN\' ? currentCustomer.balance :\n                       currency === \'USD\' ? currentCustomer.balanceUSD :\n                       currency === \'EUR\' ? currentCustomer.balanceEUR : currentCustomer.balanceGBP;\n    } else if (withdrawType === \'profit\') {\n        balanceSource = currentCustomer.profitBalance || 0;\n    } else if (withdrawType === \'robot_profit\') {\n        balanceSource = currentCustomer.robotProfit || 0;\n    }\n    \n    if (balanceSource < amount) {\n        showToast(\'Insufficient funds. Available: \' + balanceSource.toLocaleString() + \' \' + currency, \'error\');\n        return;\n    }\n    \n    const customers = JSON.parse(localStorage.getItem(\'customers\')) || [];\n    const customerIndex = customers.findIndex(c => c.account === currentCustomer.account);\n    \n    // Calculate withdrawal fee\n    const fee = amount * 0.01;\n    const totalAmount = amount + fee;\n    \n    // Deduct from appropriate balance\n    if (withdrawType === \'main\') {\n        if (currency === \'NGN\') customers[customerIndex].balance -= totalAmount;\n        else if (currency === \'USD\') customers[customerIndex].balanceUSD -= totalAmount;\n        else if (currency === \'EUR\') customers[customerIndex].balanceEUR -= totalAmount;\n        else customers[customerIndex].balanceGBP -= totalAmount;\n    } else if (withdrawType === \'profit\') {\n        customers[customerIndex].profitBalance -= totalAmount;\n    } else if (withdrawType === \'robot_profit\') {\n        customers[customerIndex].robotProfit -= totalAmount;\n    }\n    \n    // Create withdrawal record\n    const withdrawalId = generateTransferId();\n    \n    const withdrawalData = {\n        id: withdrawalId,\n        account: currentCustomer.account,\n        accountName: currentCustomer.name,\n        amount: amount,\n        currency: currency,\n        fee: fee,\n        withdrawType: withdrawType,\n        beneficiaryName: beneficiaryName,\n        beneficiaryAccount: beneficiaryAccount,\n        beneficiaryBank: beneficiaryBank,\n        swiftCode: swiftCode,\n        status: \'processing\',\n        createdAt: new Date().toISOString(),\n        signal: generateTransferSignal()\n    };\n    \n    // Add ledger entry\n    customers[customerIndex].ledger.push({\n        date: new Date().toISOString(),\n        type: \'debit\',\n        amount: amount,\n        currency: currency,\n        description: `Withdrawal to ${beneficiaryName} (${beneficiaryBank})`\n    });\n    \n    customers[customerIndex].ledger.push({\n        date: new Date().toISOString(),\n        type: \'debit\',\n        amount: fee,\n        currency: currency,\n        description: \'Withdrawal Processing Fee\'\n    });\n    \n    // Add to pending transfers\n    const pendingTransfers = JSON.parse(localStorage.getItem(\'pendingTransfers\')) || [];\n    pendingTransfers.push(withdrawalData);\n    localStorage.setItem(\'pendingTransfers\', JSON.stringify(pendingTransfers));\n    \n    // Log signal\n    logSignalTransfer(withdrawalData, \'initiated\');\n    logCustomerActivity(\'WITHDRAWAL\', `Withdrawing ${amount} ${currency} (${withdrawType}) to ${beneficiaryName}`);\n    \n    localStorage.setItem(\'customers\', JSON.stringify(customers));\n    \n    // Update session\n    currentCustomer = customers[customerIndex];\n    localStorage.setItem(\'currentCustomer\', JSON.stringify(currentCustomer));\n    \n    // Simulate bank processing\n    simulateWithdrawalProcessing(withdrawalData);\n    \n    // Update UI\n    updateBalances();\n    loadCustomerTransactions();\n    \n    showToast(`Withdrawal initiated! ${amount.toLocaleString()} ${currency} being sent to ${beneficiaryName}. Fee: ${fee.toLocaleString()} ${currency}`, \'success\');\n    \n    // Clear form\n    document.getElementById(\'withdrawAmount\').value = \'\';\n    document.getElementById(\'beneficiaryName\').value = \'\';\n    document.getElementById(\'beneficiaryAccount\').value = \'\';\n    document.getElementById(\'beneficiaryBank\').value = \'\';\n    document.getElementById(\'withdrawSwiftCode\').value = \'\';\n}\n\nfunction simulateWithdrawalProcessing(withdrawalData) {\n    setTimeout(() => {\n        withdrawalData.status = \'processing\';\n        logSignalTransfer(withdrawalData, \'processing\');\n        \n        setTimeout(() => {\n            withdrawalData.status = \'completed\';\n            withdrawalData.completedAt = new Date().toISOString();\n            logSignalTransfer(withdrawalData, \'completed\');\n            \n            const pendingTransfers = JSON.parse(localStorage.getItem(\'pendingTransfers\')) || [];\n            const index = pendingTransfers.findIndex(t => t.id === withdrawalData.id);\n            if (index !== -1) {\n                pendingTransfers[index] = withdrawalData;\n                localStorage.setItem(\'pendingTransfers\', JSON.stringify(pendingTransfers));\n            }\n            \n            logCustomerActivity(\'WITHDRAWAL_COMPLETED\', `Withdrawal completed: ${withdrawalData.amount} ${withdrawalData.currency}`);\n        }, 5000);\n    }, 2000);\n}\n\n// ============================================\n// VIRTUAL CARD FUNCTIONS\n// ============================================\n\nfunction requestVirtualCard(cardType) {\n    const customers = JSON.parse(localStorage.getItem(\'customers\')) || [];\n    const customerIndex = customers.findIndex(c => c.account === currentCustomer.account);\n    \n    if (customerIndex !== -1) {\n        // Check if customer has any card of this type\n        const existingCard = customers[customerIndex].virtualCards && \n                            customers[customerIndex].virtualCards.find(c => c.type === cardType);\n        \n        if (existingCard) {\n            showToast(`You already have a ${cardType} card ending in ${existingCard.last4}`, \'error\');\n            return;\n        }\n        \n        // Generate card\n        const cardNumber = generateCardNumber();\n        const expiryDate = generateExpiryDate();\n        const cvv = generateCVV();\n        \n        const newCard = {\n            type: cardType,\n            number: cardNumber,\n            last4: cardNumber.slice(-4),\n            expiry: expiryDate,\n            cvv: cvv,\n            status: \'active\',\n            createdAt: new Date().toISOString()\n        };\n        \n        if (!customers[customerIndex].virtualCards) {\n            customers[customerIndex].virtualCards = [];\n        }\n        \n        customers[customerIndex].virtualCards.push(newCard);\n        \n        localStorage.setItem(\'customers\', JSON.stringify(customers));\n        \n        // Update session\n        currentCustomer = customers[customerIndex];\n        localStorage.setItem(\'currentCustomer\', JSON.stringify(currentCustomer));\n        \n        // Update UI\n        loadVirtualCards();\n        \n        logCustomerActivity(\'CARD_CREATED\', `Created ${cardType} virtual card`);\n        showToast(`${cardType} card created successfully!`, \'success\');\n        alert(`Your new ${cardType} card details:\\n\\nCard Number: ${cardNumber}\\nExpiry: ${expiryDate}\\nCVV: ${cvv}\\n\\nPlease keep these details secure.`);\n    }\n}\n\nfunction loadVirtualCards() {\n    const cardsDiv = document.getElementById(\'virtualCardsList\');\n    \n    if (!currentCustomer.virtualCards || currentCustomer.virtualCards.length === 0) {\n        cardsDiv.innerHTML = \'<p style="color: #94a3b8;">No virtual cards yet. Request one above.</p>\';\n        return;\n    }\n    \n    let cardsHTML = \'\';\n    currentCustomer.virtualCards.forEach(card => {\n        const cardColor = card.type === \'Visa\' ? \'#1a1f71\' : \n                         card.type === \'Mastercard\' ? \'#eb001b\' : \'#16a34a\';\n        \n        cardsHTML += `\n            <div style="background: ${cardColor}; padding: 20px; border-radius: 10px; margin-bottom: 10px; color: white;">\n                <h4 style="margin-bottom: 10px;">${card.type}</h4>\n                <p style="font-size: 1.2rem; letter-spacing: 2px; margin-bottom: 10px;">•••• •••• •••• ${card.last4}</p>\n                <p style="font-size: 0.9rem;">Expiry: ${card.expiry} | Status: ${card.status.toUpperCase()}</p>\n                <p style="font-size: 0.85rem; margin-top: 5px;">Created: ${new Date(card.createdAt).toLocaleDateString()}</p>\n            </div>\n        `;\n    });\n    \n    cardsDiv.innerHTML = cardsHTML;\n}\n\nfunction generateCardNumber() {\n    const prefix = \'4\'; // Visa prefix (simplified)\n    let number = prefix;\n    for (let i = 0; i < 15; i++) {\n        number += Math.floor(Math.random() * 10);\n    }\n    return number.replace(/(.{4})/g, \'$1 \').trim();\n}\n\nfunction generateExpiryDate() {\n    const today = new Date();\n    const year = today.getFullYear() + 3;\n    const month = String(Math.floor(Math.random() * 12) + 1).padStart(2, \'0\');\n    return `${month}/${year.toString().slice(-2)}`;\n}\n\nfunction generateCVV() {\n    return String(Math.floor(100 + Math.random() * 900));\n}\n\n// ============================================\n// PILGRIM COIN FUNCTIONS\n// ============================================\n\nfunction generatePilgrimWallet() {\n    const customers = JSON.parse(localStorage.getItem(\'customers\')) || [];\n    const customerIndex = customers.findIndex(c => c.account === currentCustomer.account);\n    \n    if (customerIndex !== -1) {\n        const walletAddress = \'PGM\' + generateRandomString(30);\n        \n        customers[customerIndex].pilgrimWallet = walletAddress;\n        customers[customerIndex].pilgrimBalance = 0;\n        customers[customerIndex].miningActive = true;\n        \n        localStorage.setItem(\'customers\', JSON.stringify(customers));\n        \n        // Update session\n        currentCustomer = customers[customerIndex];\n        localStorage.setItem(\'currentCustomer\', JSON.stringify(currentCustomer));\n        \n        document.getElementById(\'pilgrimWallet\').textContent = walletAddress;\n        \n        logCustomerActivity(\'WALLET_CREATED\', \'Generated Pilgrim Coin wallet\');\n        showToast(\'Pilgrim Coin wallet generated!\', \'success\');\n        \n        // Start mining\n        startMiningEngine();\n    }\n}\n\nfunction minePilgrimCoin() {\n    if (!currentCustomer.pilgrimWallet) {\n        showToast(\'Please generate a wallet first\', \'error\');\n        return;\n    }\n    \n    const customers = JSON.parse(localStorage.getItem(\'customers\')) || [];\n    const customerIndex = customers.findIndex(c => c.account === currentCustomer.account);\n    \n    if (customerIndex !== -1) {\n        const miningAmount = 0.000002;\n        customers[customerIndex].pilgrimBalance += miningAmount;\n        \n        // Convert to USD (1 PGM = $0.50)\n        const usdValue = miningAmount * 0.5;\n        customers[customerIndex].balanceUSD += usdValue;\n        \n        // Add ledger entry\n        customers[customerIndex].ledger.push({\n            date: new Date().toISOString(),\n            type: \'mining\',\n            amount: usdValue,\n            currency: \'USD\',\n            description: `Pilgrim Coin mining: ${miningAmount} PGM ($${usdValue})`\n        });\n        \n        localStorage.setItem(\'customers\', JSON.stringify(customers));\n        \n        // Update session\n        currentCustomer = customers[customerIndex];\n        localStorage.setItem(\'currentCustomer\', JSON.stringify(currentCustomer));\n        \n        // Update UI\n        updateBalances();\n        loadCustomerTransactions();\n        \n        logCustomerActivity(\'MINING\', `Mined ${miningAmount} PGM ($${usdValue})`);\n        showToast(`Mined ${miningAmount} PGM ($${usdValue})`, \'success\');\n    }\n}\n\nfunction startMiningEngine() {\n    if (miningInterval) {\n        clearInterval(miningInterval);\n    }\n    \n    miningInterval = setInterval(() => {\n        const customers = JSON.parse(localStorage.getItem(\'customers\')) || [];\n        const customerIndex = customers.findIndex(c => c.account === currentCustomer.account);\n        \n        if (customerIndex !== -1 && customers[customerIndex].miningActive) {\n            const miningAmount = 0.000002;\n            customers[customerIndex].pilgrimBalance += miningAmount;\n            \n            const usdValue = miningAmount * 0.5;\n            customers[customerIndex].balanceUSD += usdValue;\n            \n            customers[customerIndex].ledger.push({\n                date: new Date().toISOString(),\n                type: \'mining\',\n                amount: usdValue,\n                currency: \'USD\',\n                description: `Auto mining: ${miningAmount} PGM`\n            });\n            \n            localStorage.setItem(\'customers\', JSON.stringify(customers));\n            \n            // Update session\n            currentCustomer = customers[customerIndex];\n            localStorage.setItem(\'currentCustomer\', JSON.stringify(currentCustomer));\n            \n            // Update UI\n            updateBalances();\n            loadCustomerTransactions();\n        }\n    }, 60000); // Mine every minute\n}\n\nfunction robotTrade() {\n    if (!currentCustomer.pilgrimWallet) {\n        showToast(\'Please generate a wallet first\', \'error\');\n        return;\n    }\n    \n    const customers = JSON.parse(localStorage.getItem(\'customers\')) || [];\n    const customerIndex = customers.findIndex(c => c.account === currentCustomer.account);\n    \n    if (customerIndex !== -1) {\n        // Robot trades 0.5% of USD balance\n        const tradeAmount = customers[customerIndex].balanceUSD * 0.005;\n        \n        if (tradeAmount > 0) {\n            customers[customerIndex].balanceUSD += tradeAmount;\n            customers[customerIndex].robotProfit = (customers[customerIndex].robotProfit || 0) + tradeAmount;\n            \n            customers[customerIndex].ledger.push({\n                date: new Date().toISOString(),\n                type: \'robot_trade\',\n                amount: tradeAmount,\n                currency: \'USD\',\n                description: \'Robot trading profit (0.5%)\'\n            });\n            \n            localStorage.setItem(\'customers\', JSON.stringify(customers));\n            \n            // Update session\n            currentCustomer = customers[customerIndex];\n            localStorage.setItem(\'currentCustomer\', JSON.stringify(currentCustomer));\n            \n            // Update UI\n            updateBalances();\n            loadCustomerTransactions();\n            \n            logCustomerActivity(\'ROBOT_TRADE\', `Robot trade profit: $${tradeAmount.toFixed(4)}`);\n            showToast(`Robot trade completed! Profit: $${tradeAmount.toFixed(4)}`, \'success\');\n        } else {\n            showToast(\'Insufficient balance for robot trading\', \'error\');\n        }\n    }\n}\n\n// ============================================\n// FOREX TRADING FUNCTIONS\n// ============================================\n\nfunction startAutoTrading() {\n    if (autoTradingInterval) {\n        showToast(\'Auto trading is already running\', \'error\');\n        return;\n    }\n    \n    showToast(\'Auto trading started! Robot will trade every 6 seconds.\', \'success\');\n    logCustomerActivity(\'AUTO_TRADING\', \'Started auto trading\');\n    \n    autoTradingInterval = setInterval(() => {\n        executeForexTrade();\n    }, 6000); // Trade every 6 seconds\n}\n\nfunction stopAutoTrading() {\n    if (autoTradingInterval) {\n        clearInterval(autoTradingInterval);\n        autoTradingInterval = null;\n        showToast(\'Auto trading stopped\', \'success\');\n        logCustomerActivity(\'AUTO_TRADING\', \'Stopped auto trading\');\n    } else {\n        showToast(\'Auto trading is not running\', \'error\');\n    }\n}\n\nfunction executeForexTrade() {\n    const customers = JSON.parse(localStorage.getItem(\'customers\')) || [];\n    const customerIndex = customers.findIndex(c => c.account === currentCustomer.account);\n    \n    if (customerIndex !== -1) {\n        // Simulate forex trade with small profit\n        const tradeProfit = Math.random() * 0.5 + 0.1; // $0.10 to $0.60\n        \n        customers[customerIndex].balanceUSD += tradeProfit;\n        customers[customerIndex].robotProfit = (customers[customerIndex].robotProfit || 0) + tradeProfit;\n        \n        customers[customerIndex].ledger.push({\n            date: new Date().toISOString(),\n            type: \'forex_trade\',\n            amount: tradeProfit,\n            currency: \'USD\',\n            description: \'MetaTrader auto trade profit\'\n        });\n        \n        localStorage.setItem(\'customers\', JSON.stringify(customers));\n        \n        // Update session\n        currentCustomer = customers[customerIndex];\n        localStorage.setItem(\'currentCustomer\', JSON.stringify(currentCustomer));\n        \n        // Update UI\n        updateBalances();\n        loadCustomerTransactions();\n    }\n}\n\nfunction viewForexBalance() {\n    const customers = JSON.parse(localStorage.getItem(\'customers\')) || [];\n    const customer = customers.find(c => c.account === currentCustomer.account);\n    \n    if (customer) {\n        const balance = customer.balanceUSD || 0;\n        const profit = customer.robotProfit || 0;\n        alert(`Forex Trading Balance\\n\\nMetaTrader 4/5 - Server: 6G-001\\n\\nCurrent Balance: $${balance.toFixed(2)}\\nRobot Profit: $${profit.toFixed(2)}\\nTotal: $${(balance + profit).toFixed(2)}\\n\\nAuto Trading: ${autoTradingInterval ? \'ACTIVE\' : \'INACTIVE\'}`);\n    }\n}\n\n// ============================================\n// ACCOUNT SETTINGS\n// ============================================\n\nfunction changePin() {\n    const newPin = document.getElementById(\'newPin\').value.trim();\n    \n    if (!newPin || newPin.length !== 4 || isNaN(newPin)) {\n        showToast(\'Please enter a valid 4-digit PIN\', \'error\');\n        return;\n    }\n    \n    const customers = JSON.parse(localStorage.getItem(\'customers\')) || [];\n    const customerIndex = customers.findIndex(c => c.account === currentCustomer.account);\n    \n    if (customerIndex !== -1) {\n        customers[customerIndex].loginPin = newPin;\n        \n        localStorage.setItem(\'customers\', JSON.stringify(customers));\n        \n        // Update session\n        currentCustomer = customers[customerIndex];\n        localStorage.setItem(\'currentCustomer\', JSON.stringify(currentCustomer));\n        \n        document.getElementById(\'newPin\').value = \'\';\n        \n        logCustomerActivity(\'PIN_CHANGED\', \'Login PIN updated\');\n        showToast(\'PIN updated successfully!\', \'success\');\n    }\n}\n\n// ============================================\n// TRANSACTION HISTORY\n// ============================================\n\nfunction loadCustomerTransactions() {\n    const tbody = document.getElementById(\'customerTransactionBody\');\n    \n    if (!tbody) return;\n    \n    if (!currentCustomer.ledger || currentCustomer.ledger.length === 0) {\n        tbody.innerHTML = \'<tr><td colspan="6" style="text-align: center; color: #94a3b8;">No transactions yet</td></tr>\';\n        return;\n    }\n    \n    tbody.innerHTML = \'\';\n    \n    // Show last 20 transactions\n    const recentTransactions = currentCustomer.ledger.slice(-20).reverse();\n    \n    recentTransactions.forEach(tx => {\n        const row = document.createElement(\'tr\');\n        const amountColor = tx.type === \'credit\' || tx.type === \'mining\' || tx.type === \'robot_trade\' ? \'#22c55e\' : \'#ef4444\';\n        row.innerHTML = `\n            <td>${new Date(tx.date).toLocaleString()}</td>\n            <td style="color: ${amountColor}; font-weight: 600;">${tx.type.toUpperCase().replace(\'_\', \' \')}</td>\n            <td>${amountColor === \'#22c55e\' ? \'+\' : \'-\'}${tx.amount.toLocaleString()}</td>\n            <td>${tx.currency}</td>\n            <td>${tx.description}</td>\n            <td><span class="status status-success">COMPLETED</span></td>\n        `;\n        tbody.appendChild(row);\n    });\n}\n\n// ============================================\n// UTILITY FUNCTIONS\n// ============================================\n\nfunction logCustomerActivity(activity, details) {\n    // This would log to the admin terminal for monitoring\n    console.log(`[CUSTOMER] ${currentCustomer.name} - ${activity}: ${details}`);\n}\n\nfunction showToast(message, type = \'success\') {\n    const toast = document.createElement(\'div\');\n    toast.className = \'toast\';\n    toast.style.background = type === \'success\' ? \'#16a34a\' : \'#ef4444\';\n    toast.textContent = message;\n    \n    document.body.appendChild(toast);\n    \n    setTimeout(() => {\n        toast.remove();\n    }, 3000);\n}\n\nfunction generateTransferId() {\n    const timestamp = Date.now().toString(36);\n    const random = Math.random().toString(36).substring(2, 8);\n    return \'TXN\' + timestamp.toUpperCase() + random.toUpperCase();\n}\n\nfunction generateRandomString(length) {\n    const chars = \'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\';\n    let result = \'\';\n    for (let i = 0; i < length; i++) {\n        result += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return result;\n}\n\n// ============================================\n// INITIALIZATION\n// ============================================\n\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n    // Check if customer login page\n    if (document.getElementById(\'accountNumber\')) {\n        // This is login page, load sync status\n        checkSyncStatus();\n    }\n});\n\nfunction checkSyncStatus() {\n    const lastSync = localStorage.getItem(\'customerLastSync\');\n    const today = new Date().toDateString();\n    \n    const syncButton = document.getElementById(\'syncButton\');\n    const syncStatus = document.getElementById(\'syncStatus\');\n    \n    if (syncButton && syncStatus) {\n        if (lastSync === today) {\n            syncButton.disabled = true;\n            syncButton.style.opacity = \'0.5\';\n            syncStatus.textContent = \'✅ Synced today: $5 credited\';\n            syncStatus.style.color = \'#22c55e\';\n        } else {\n            syncStatus.textContent = \'Click to sync and receive your $5 bonus\';\n        }\n    }\n}\n\nfunction dailySync() {\n    const lastSync = localStorage.getItem(\'customerLastSync\');\n    const today = new Date().toDateString();\n    \n    if (lastSync === today) {\n        showToast(\'Already synced today. Come back tomorrow!\', \'error\');\n        return;\n    }\n    \n    // Check if user is logged in\n    const currentCustomer = JSON.parse(localStorage.getItem(\'currentCustomer\'));\n    if (!currentCustomer) {\n        alert(\'Please login first to sync your account\');\n        return;\n    }\n    \n    // Add $5 bonus\n    const customers = JSON.parse(localStorage.getItem(\'customers\')) || [];\n    const customerIndex = customers.findIndex(c => c.account === currentCustomer.account);\n    \n    if (customerIndex !== -1) {\n        customers[customerIndex].balanceUSD += 5;\n        \n        // Add ledger entry\n        customers[customerIndex].ledger.push({\n            date: new Date().toISOString(),\n            type: \'credit\',\n            amount: 5,\n            currency: \'USD\',\n            description: \'Daily sync bonus\'\n        });\n        \n        localStorage.setItem(\'customers\', JSON.stringify(customers));\n        localStorage.setItem(\'customerLastSync\', today);\n        localStorage.setItem(\'currentCustomer\', JSON.stringify(customers[customerIndex]));\n        \n        const syncStatus = document.getElementById(\'syncStatus\');\n        if (syncStatus) {\n            syncStatus.textContent = \'✅ Synced successfully! $5 credited to your account.\';\n            syncStatus.style.color = \'#22c55e\';\n        }\n        \n        showToast(\'$5 sync bonus credited to your account!\', \'success\');\n    }\n}\n</create-file>\n</function_calls>'}